# 构建修复说明（2026-03-01）

## 背景
- 在 Windows + MSVC 下执行 `cmake --build` 时，出现全量构建失败。
- 错误包含 `C2065`（未定义标识符）与 `C2001`（常量中有换行符）等。

## 根因定位
1. `market_data_api.cpp` 中使用了不存在的订阅常量 `DATA_TYPE_MARKET`。  
   TDF 头文件中有效位掩码为 `DATA_TYPE_TRANSACTION / DATA_TYPE_ORDER / DATA_TYPE_ORDERQUEUE`。
2. 工程未统一指定源码编码，MSVC 在部分环境下按本地代码页解析中文字符串，导致字符串字面量误解析并触发语法错误（典型为 `C2001`）。

## 修复内容
### 1) 订阅常量修复
- 文件：`market_data_api.cpp`
- 修改：  
  `settings.nTypeFlags = DATA_TYPE_TRANSACTION | DATA_TYPE_ORDER;`

### 2) MSVC 源码编码统一
- 文件：`CMakeLists.txt`
- 新增：
  - 在 `MSVC` 下追加编译选项 `/utf-8`
  - 目的：强制按 UTF-8 解析源码，避免中文字符串误解析

## 验证记录
1. 重新生成构建文件：  
   `cmake -S . -B build/vs2022_probe`（成功）
2. 构建主目标：  
   `cmake --build build/vs2022_probe --config Release --target limitUpHittingMarket`（成功）
3. 全量构建：  
   `cmake --build build/vs2022_probe --config Release`（成功）

## 影响范围
- 仅影响构建配置与行情订阅类型定义，不改变策略逻辑。
- 对 Linux/GCC 路径无行为变化（`/utf-8` 仅对 MSVC 生效）。
